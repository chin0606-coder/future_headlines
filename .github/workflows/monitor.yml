name: FH Intelligence Radar

on:
  schedule:
    - cron: '0 * * * *'  # æ¯å°æ™‚æ•´é»åŸ·è¡Œ (UTC æ™‚é–“)
  workflow_dispatch:      # å…è¨±æ‰‹å‹•æ¸¬è©¦

jobs:
  scan-and-report:
    runs-on: ubuntu-latest
    permissions:          # é—œéµï¼šçµ¦äºˆå¯«å…¥æ¬Šé™ï¼Œå¦å‰‡ç„¡æ³•å­˜æª”
      contents: write

    steps:
      - name: ğŸ“¥ æª¢å‡ºä»£ç¢¼
        uses: actions/checkout@v3

      - name: ğŸ è¨­å®š Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: ğŸ“¦ å®‰è£ä¾è³´
        run: |
          pip install -r requirements.txt

      - name: ğŸ“¡ åŸ·è¡Œç›£æ§èˆ‡æ¨æ’­
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        # é—œéµä¿®æ­£ï¼šåŠ ä¸Š --telegram åƒæ•¸ï¼Œä¸¦ä½¿ç”¨ --once å–®æ¬¡åŸ·è¡Œ
        run: python polymarket_monitor.py --once --telegram

      - name: ğŸ’¾ è¨˜æ†¶å­˜æª” (Commit history)
        run: |
          git config --global user.name "FH-Bot"
          git config --global user.email "bot@futureheadlines.com"
          
          # æª¢æŸ¥ history.json æ˜¯å¦æœ‰è®Šå‹•
          if [[ -n $(git status -s history.json) ]]; then
            git add history.json
            git commit -m "ğŸ“ Update market history [skip ci]"
            git push
          else
            echo "âœ… ç„¡é¡¯è‘—æ•¸æ“šè®Šå‹•ï¼Œç„¡éœ€å­˜æª”ã€‚"
          fi
