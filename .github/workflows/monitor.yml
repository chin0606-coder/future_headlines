name: FH Intelligence Radar

on:
  schedule:
    - cron: '0 * * * *'    # æ¯å°æ™‚ç›£æ§
    - cron: '0 0 * * *'    # æ¯å¤© 08:00 æ™¨å ±
  
  # âœ¨ é€™è£¡å‡ç´šäº†ï¼åŠ å…¥æ‰‹å‹•æ§åˆ¶é¢æ¿
  workflow_dispatch:
    inputs:
      force_mode:
        description: 'å¼·åˆ¶åŸ·è¡Œæ¨¡å¼'
        required: true
        default: 'Auto'
        type: choice
        options:
        - Auto (ä¾ç…§æ™‚é–“åˆ¤æ–·)
        - Force Daily Brief (ç«‹å³ç™¼é€æ™¨å ±)
        - Force Hourly Scan (ç«‹å³æƒæç•°å‹•)

jobs:
  scan-and-report:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: ğŸ“¥ æª¢å‡ºä»£ç¢¼
        uses: actions/checkout@v3

      - name: ğŸ è¨­å®š Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: ğŸ“¦ å®‰è£ä¾è³´
        run: |
          pip install -r requirements.txt

      - name: ğŸ“¡ åŸ·è¡Œæƒ…å ±æƒæ
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # å–å¾—è¼¸å…¥çš„æ¨¡å¼
          INPUT_MODE="${{ github.event.inputs.force_mode }}"
          CURRENT_HOUR=$(date -u +%H)
          
          echo "ç›®å‰é¸æ“‡æ¨¡å¼: $INPUT_MODE"
          echo "ç›®å‰ UTC æ™‚é–“: $CURRENT_HOUR"

          # é‚è¼¯åˆ¤æ–·
          if [ "$INPUT_MODE" == "Force Daily Brief" ]; then
            echo "â˜€ï¸ CEO æ‰‹å‹•æŒ‡ä»¤ï¼šå¼·åˆ¶ç™¼é€æ™¨å ±ï¼"
            python polymarket_monitor.py --daily --telegram

          elif [ "$INPUT_MODE" == "Force Hourly Scan" ]; then
            echo "ğŸ” CEO æ‰‹å‹•æŒ‡ä»¤ï¼šå¼·åˆ¶æƒæç•°å‹•..."
            python polymarket_monitor.py --once --telegram

          # è‡ªå‹•æ’ç¨‹é‚è¼¯ (Auto)
          elif [ "$CURRENT_HOUR" == "00" ] && [ "${{ github.event_name }}" == "schedule" ]; then
            echo "â° æ™¨å ±æ™‚é–“åˆ°ï¼Œè‡ªå‹•ç™¼é€..."
            python polymarket_monitor.py --daily --telegram
          else
            echo "ğŸ• ä¾‹è¡Œæª¢æŸ¥ï¼ŒåŸ·è¡Œæ¯å°æ™‚æƒæ..."
            python polymarket_monitor.py --once --telegram
          fi

      - name: ğŸ’¾ è¨˜æ†¶å­˜æª”
        run: |
          git config --global user.name "FH-Bot"
          git config --global user.email "bot@futureheadlines.com"
          if [[ -n $(git status -s history.json) ]]; then
            git add history.json
            git commit -m "ğŸ“ Update history [skip ci]"
            git push
          else
            echo "âœ… ç„¡è®Šå‹•ï¼Œç„¡éœ€å­˜æª”"
          fi
