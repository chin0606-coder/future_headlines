name: FH Intelligence Radar

on:
  schedule:
    - cron: '0 * * * *'    # ä»»å‹™ A: æ¯å°æ™‚æ•´é»åŸ·è¡Œ (ç›£æ§ç•°å‹•)
    - cron: '0 0 * * *'    # ä»»å‹™ B: æ¯å¤© UTC 00:00 (å°ç£ 08:00) åŸ·è¡Œ (æ¯æ—¥æ™¨å ±)
  workflow_dispatch:        # å…è¨±æ‰‹å‹•æ¸¬è©¦

jobs:
  scan-and-report:
    runs-on: ubuntu-latest
    permissions:
      contents: write       # çµ¦äºˆå¯«å…¥æ¬Šé™ (å­˜æª”ç”¨)

    steps:
      - name: ğŸ“¥ æª¢å‡ºä»£ç¢¼
        uses: actions/checkout@v3

      - name: ğŸ è¨­å®š Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: ğŸ“¦ å®‰è£ä¾è³´
        run: |
          pip install -r requirements.txt

      # åˆ¤æ–·æ˜¯ã€Œæ¯æ—¥æ™¨å ±ã€é‚„æ˜¯ã€Œæ¯å°æ™‚ç›£æ§ã€
      - name: ğŸ“¡ åŸ·è¡Œæƒ…å ±æƒæ
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # å–å¾—ç•¶å‰å°æ™‚ (UTC)
          CURRENT_HOUR=$(date -u +%H)
          
          # å¦‚æœæ˜¯ UTC 00:00 (å°ç£ 08:00)ï¼ŒåŸ·è¡Œæ™¨å ±æ¨¡å¼
          if [ "$CURRENT_HOUR" == "00" ] && [ "${{ github.event_name }}" == "schedule" ]; then
            echo "â˜€ï¸ åµæ¸¬åˆ°æ™¨å ±æ™‚é–“ï¼Œå•Ÿå‹• Daily Mode..."
            python polymarket_monitor.py --daily --telegram
          else
            # å…¶ä»–æ™‚é–“ï¼ŒåŸ·è¡Œä¸€èˆ¬ç›£æ§æ¨¡å¼
            echo "ğŸ” åŸ·è¡Œæ¯å°æ™‚ç•°å‹•ç›£æ§..."
            python polymarket_monitor.py --once --telegram
          fi

      - name: ğŸ’¾ è¨˜æ†¶å­˜æª” (Commit history)
        run: |
          git config --global user.name "FH-Bot"
          git config --global user.email "bot@futureheadlines.com"
          
          if [[ -n $(git status -s history.json) ]]; then
            git add history.json
            git commit -m "ğŸ“ Update market history [skip ci]"
            git push
          else
            echo "âœ… ç„¡é¡¯è‘—æ•¸æ“šè®Šå‹•ï¼Œç„¡éœ€å­˜æª”ã€‚"
          fi
